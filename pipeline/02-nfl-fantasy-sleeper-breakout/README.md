# NFL Fantasy Sleeper Breakout Scripts

This directory contains R scripts for analyzing NFL fantasy football breakout candidates, specifically focusing on second-year players.

## Scripts

### `defensive_stats.R`

Generates defensive power rankings for NFL teams based on points allowed per game, with additional metrics for rush and pass defense.

**Usage:**
```bash
Rscript defensive_stats.R [year] [output_file]
```

**Example:**
```bash
Rscript defensive_stats.R 2023 defense_rankings_2023.csv
```

---

### `collect_second_year_data.R`

Collects and processes comprehensive data for second-year NFL players (RB, WR, TE) to identify potential fantasy breakout candidates. Calculates sleeper scores based on draft value, performance, age, ECR, defensive matchup, and snap trends.

**Usage:**

Note: `defense_rankings_file` is generated by the previous command `defensive_stats.R` and is used to augment the sleeper score to favor players with favorable matchups (RB against a bad run defense or WR against a bad pass defense will increase the sleeper score)

```bash
# Process all weeks (3-18) for a season
Rscript collect_second_year_data.R [year] [output_directory] [defense_rankings_file]

# Process a specific week only
Rscript collect_second_year_data.R [year] [output_directory] [defense_rankings_file] [week]
```

**Examples:**
```bash
# Process entire 2024 season
Rscript collect_second_year_data.R 2024 ./output/weekly_player_stats/ ./output/defensive_power_rankings/defensive_power_rankings_2024.csv

# Process only week 5 of 2024 season
Rscript collect_second_year_data.R 2024 ./output/weekly_player_stats/ ./output/defensive_power_rankings/defensive_power_rankings_2024.csv w5
```

**Output columns (when week has occurred):**
- `current_week_fp`: Current week fantasy points
- `fp_week_delta`: Fantasy points delta vs previous week
- `hit`: Binary indicator (1 if FP increased by 5+ points, 0 otherwise)
- `sleeper_score`: Composite score (max 175 points) based on six weighted components

If the week hasn't occurred yet, `current_week_fp`, `fp_week_delta`, and `hit` are excluded.


---

## Order of Execution and Usage

### Building Historical Data for Model Training

**Step 1: Generate defensive power rankings**

```bash
Rscript scripts/defensive_stats.R 2024 ./output/defensive_power_rankings/defensive_power_rankings_2024.csv
```

**Step 2: Collect historical player data**

```bash
Rscript scripts/collect_second_year_data.R 2024 ./output/weekly_player_stats/ ./output/defensive_power_rankings/defensive_power_rankings_2024.csv
```

Generates data for weeks 3-18 of 2024 season, including sleeper scores and (for completed weeks) `current_week_fp`, `fp_week_delta`, and `hit` columns.

**Step 3: Train the model**

Model training code is located at `server/src/Fastbreak.Research.Cli/Commands/02-nfl-fantasy-sleeper-breakout`.

### Making Future Predictions

**Pull data for a specific upcoming week:**

```bash
Rscript scripts/collect_second_year_data.R 2024 ./output/weekly_player_stats/ ./output/defensive_power_rankings/defensive_power_rankings_2024.csv w3
```

If the week hasn't occurred yet, `current_week_fp`, `fp_week_delta`, and `hit` columns are excluded. Once the week completes, these columns are included automatically.